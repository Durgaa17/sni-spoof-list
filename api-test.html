<!DOCTYPE html>
<html>
<head>
    <title>Simple API Test</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        button { padding: 10px; margin: 5px; }
        pre { background: #f5f5f5; padding: 10px; border: 1px solid #ddd; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>Simple Check-Host API Test</h1>
    
    <button onclick="testPing()">Test Ping API</button>
    <button onclick="testTCP()">Test TCP API</button>
    <button onclick="testHTTP()">Test HTTP API</button>
    <button onclick="testAll()">Test All</button>
    
    <div id="results"></div>

    <script>
        async function testPing() {
            await testEndpoint('ping', 'google.com');
        }

        async function testTCP() {
            await testEndpoint('tcp', 'google.com:80');
        }

        async function testHTTP() {
            await testEndpoint('http', 'https://google.com');
        }

        async function testAll() {
            await testPing();
            await new Promise(resolve => setTimeout(resolve, 1000));
            await testTCP();
            await new Promise(resolve => setTimeout(resolve, 1000));
            await testHTTP();
        }

        async function testEndpoint(checkType, host) {
            const results = document.getElementById('results');
            const url = `https://check-host.net/check-${checkType}?host=${host}&max_nodes=1`;
            
            results.innerHTML += `<p><strong>Testing ${checkType}:</strong> ${url}</p>`;
            
            try {
                const response = await fetch(url, {
                    headers: { 'Accept': 'application/json' }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    results.innerHTML += `<p class="success">‚úÖ SUCCESS - Request ID: ${data.request_id}</p>`;
                    
                    // Now get the results
                    await getResults(data.request_id, checkType);
                } else {
                    results.innerHTML += `<p class="error">‚ùå FAILED - HTTP ${response.status}</p>`;
                }
            } catch (error) {
                results.innerHTML += `<p class="error">‚ùå ERROR - ${error.message}</p>`;
            }
            
            results.innerHTML += '<hr>';
        }

        async function getResults(requestId, checkType) {
            const results = document.getElementById('results');
            
            // Wait for results to be ready
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            try {
                const resultsUrl = `https://check-host.net/check-result/${requestId}`;
                const response = await fetch(resultsUrl, {
                    headers: { 'Accept': 'application/json' }
                });
                
                if (response.ok) {
                    const resultData = await response.json();
                    results.innerHTML += `<p>üìä Results: ${JSON.stringify(resultData)}</p>`;
                } else {
                    results.innerHTML += `<p class="error">‚ùå Failed to get results: HTTP ${response.status}</p>`;
                }
            } catch (error) {
                results.innerHTML += `<p class="error">‚ùå Error getting results: ${error.message}</p>`;
            }
        }

        // Test if we can even reach the API domain
        async function testDomain() {
            const results = document.getElementById('results');
            results.innerHTML = '<p>Testing if check-host.net is reachable...</p>';
            
            try {
                const response = await fetch('https://check-host.net/', { mode: 'no-cors' });
                results.innerHTML += '<p class="success">‚úÖ Domain is reachable</p>';
            } catch (error) {
                results.innerHTML += `<p class="error">‚ùå Cannot reach check-host.net: ${error.message}</p>`;
            }
        }

        // Run domain test on load
        testDomain();
    </script>
</body>
</html>
